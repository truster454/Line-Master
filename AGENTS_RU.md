# Руководство по репозиторию

## Структура проекта и организация модулей
- `line-master/` содержит приложение Vite + TypeScript.
- `line-master/src/` — основной исходный код.
- `line-master/src/background/`, `line-master/src/content/`, `line-master/src/shared/` зарезервированы для модулей расширения (background/content scripts и общие утилиты).
- `line-master/src/data/` хранит JSON-данные (например, `openings.json`).
- `line-master/public/` содержит статические ассеты и метаданные расширения (иконки, `manifest.json`).
- `line-master/tests/` существует, но пока пуст.

## Команды сборки, тестов и разработки
Запускать из `line-master/`:
- `npm run dev` — стартует dev-сервер Vite.
- `npm run build` — проверка типов `tsc` и сборка production.
- `npm run preview` — локальный просмотр production-сборки.

## Стиль кодирования и именование
- Включен строгий режим TypeScript (`tsconfig.json`), поэтому типы должны быть явными, без неиспользуемых переменных/параметров.
- Отступы 2 пробела в `.ts` и `.css` для единообразия.
- `camelCase` для переменных/функций, `PascalCase` для типов, `kebab-case` для ассетов.
- Форматтера/линтера пока нет; изменения должны быть минимальными и консистентными с соседним кодом.

## Тестирование
- Тестовый раннер не настроен, `line-master/tests/` пустой.
- Если добавляешь тесты, зафиксируй фреймворк и добавь `npm run test`.
- Имена тестов должны отражать функциональность, например `loads openings index`.

## Коммиты и PR
- Истории коммитов еще нет, формального стандарта тоже.
- Используй короткие императивные названия (можно Conventional Commits), например `feat: add openings loader`.
- В PR желательно краткое описание, ключевые изменения, скриншоты при изменениях UI.

## Конфигурация
- Проект основан на Vite + TypeScript (`"type": "module"`).
- JSON-данные в `src/data/` бандлятся; большие добавления делать осознанно.

## ТЗ проекта (полное)
- Тип продукта: расширение Google Chrome (Manifest V3).
- Назначение: шахматный «Theory Bot» с большой базой дебютов, поиском, фильтрами, избранным и рекомендациями по позиции.
- Режимы: каталог дебютов, рекомендации по позиции, избранное, настройки.
- Базовые сущности: дебют, линия, рейтинг, тип дебюта, сложность, теги, ECO.
- Источники позиции: chess.com и lichess.org через content scripts.
- Хранение: локально (JSON + индекс), `chrome.storage` для избранного и настроек.
- UI: popup, side panel, options page.
- Аналитика и комментарии: интерфейсы заложить сейчас, реализацию позже.

## Архитектура (модули и ответственность)
- `src/background/` — MV3 service worker, хранение настроек, синхронизация.
- `src/content/` — извлечение позиции/ходов, нормализация, передача в UI.
- `src/core/` — доменная логика: поиск, фильтры, рекомендации, форматы.
- `src/data/` — база дебютов и индекс для быстрых запросов.
- `src/ui/` — React UI (popup, panel, options) и состояние.
- `src/shared/` — общие типы, константы, утилиты.

## Интерфейсы модулей (контракты)
- `core/openings/index.ts` экспортирует `OpeningsService` с методами `search`, `recommendByPosition`, `getById`, `listAll`.
- `core/openings/schema.ts` задает `Opening`, `RatingBand`, `OpeningType`, `Difficulty`.
- `content/index.ts` экспортирует `detectPosition(): Promise<PositionSnapshot | null>`.
- `background/storage.ts` экспортирует `FavoritesRepo` и `SettingsRepo` для `chrome.storage`.
- `ui/state/store.ts` хранит `UIState` с фильтрами, избранным и текущей позицией.

## План работ (максимальная детализация)
1. Инициализация инструментов и сборки.
2. Создание структуры и пустых файлов.
3. Базовый `manifest.json` под MV3.
4. Настройка entry points для background/content/UI.
5. Каркас background service worker.
6. Каркас content script.
7. Каркас UI: popup, panel, options.
8. Подключение состояния UI.
9. Доменная модель (`Opening`, `RatingBand`, `OpeningType`, `Difficulty`).
10. Загрузка базы дебютов (JSON) в `core/openings`.
11. Поиск по названию и ECO.ы
12. Фильтры по рейтингу, типу, сложности.
13. Рекомендации по позиции (сопоставление по ходам).
14. Индексация базы (по первым ходам/ключам).
15. Избранное через `chrome.storage`.
16. Сохранение настроек через `chrome.storage`.
17. Детектор chess.com (ходы/FEN).
18. Детектор lichess.org (ходы/FEN).
19. Нормализация ходов и форматов.
20. Интеграция: позиция -> рекомендации -> UI.
21. Улучшение UX карточек и списка.
22. Производительность и кеширование.
23. Ручное тестирование на chess.com и lichess.org.
24. Исправления и стабилизация.
25. Упаковка для публикации.
26. Документация по сборке и установке.

## Оценка времени (один разработчик)
- Минимально рабочая версия: 8–12 рабочих дней.
- Стабильная версия с детекторами и индексом: 12–18 рабочих дней.
- Если базы дебютов нет или нужна ручная проработка: +5–15 рабочих дней.

## Риски и допущения
- Изменения DOM сайтов могут ломать детекторы.
- Большая база дебютов требует индексации и оптимизации.
- Аналитика и комментарии — отдельный этап.